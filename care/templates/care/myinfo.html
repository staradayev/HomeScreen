{% extends 'care/base.html' %}

{% block header %}

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
    	<!-- Brand and toggle get grouped for better mobile display -->
    	<div class="navbar-header">
      		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        		<span class="sr-only">Toggle navigation</span>
        		<span class="icon-bar"></span>
        		<span class="icon-bar"></span>
        		<span class="icon-bar"></span>
      		</button>
      		<a class="navbar-brand" href="#">ATO.care</a>
    	</div>

    <!-- Collect the nav links, forms, and other content for toggling -->
	    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	        <ul class="nav navbar-nav">
	        	<li>
	        		<a href="{% url 'care:detail' %}"><i class="fa fa-image fa-lg"></i> My pictures</a>
	        	</li>
	        	<li  class="active">
	        		<a href="{% url 'care:myinfo' %}"><i class="fa fa-user fa-lg"></i> My info</a>
	        	</li>
	        	<li>
	        		<a href="{% url 'care:upload' %}"><i class="fa fa-upload fa-lg"></i> Upload</a>
	        	</li>
	        </ul>
	      
	        <ul class="nav navbar-nav navbar-right">
	        		
	          	<li><a href="{% url 'care:myinfo' %}">{{ user.get_username }}</a></li>
	        		
	        	<li><a href="{% url 'care:logout' %}" class="navbar-link">Logout <i class="fa fa-sign-out fa-lg"></i> </a></li>
	      	    
	        </ul>
	    </div><!-- /.navbar-collapse -->
  	</div><!-- /.container-fluid -->
</nav>

{% endblock %}

{% block content %}
<!-- Modal -->
<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Add new link</h4>
      </div>
      <div class="modal-body">
      	<p style="display:none;" class="text-warning fa fa-warning fa-lg" id="cat_warning"></p>
        <div class="form-group">
            <label for="id_link_type">Choose link type:</label>
            <div class="form-group">
                <div class="input-group "  required>
                	<select class="selectpicker" data-size="auto" id="id_link_type" name="link_type">
                		{% for link_type in link_types %}
                			<option value="{{ link_type.id }}" class="fa fa-{{ link_type.type_tag }}"><p>&nbsp;{{ link_type.type_tag }}</p></option>
                		{% endfor %}
					</select>
					<span class="input-group-addon"><span class="glyphicon glyphicon-asterisk"></span></span>
                    </div>
                </div>
        	</div>	
        	<label for="id_link_url">Link URL:</label>
        	<div class="input-group">
                <input type="text" class="form-control" name="link_url" id="id_link_url" placeholder="url" required maxlength="75" >
                <span class="input-group-addon"><span class="glyphicon glyphicon-asterisk"></span></span>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="BtnSendLink">Save changes</button>
      </div>
    </div>
  </div>
</div>
<br>
<div class="row">
	<div class="col-md-12">
		<h2>User information: </h2>
			<h3 class="text-warning">{% if name_empty %}
				<i class="fa fa-info-circle fa-1x"></i>&nbsp;Fill your name, to continue...
				{% endif %} </h3>
			<br />
	</div>
</div>
<div class="row">
    <div class="col-md-6">
    	<div class="row">
    		<div class="col-md-12">
    			
				<form action="{% url 'care:myinfo' %}" method="post" role="form">
				    {% csrf_token %}
				    {% if form.errors %}			
	                <div class="alert alert-danger">
	                    <span class="glyphicon glyphicon-remove"></span><strong> Error! {{form.errors}}</strong>
	                </div>
	                {% endif %}

	                <div class="form-group">
                    	<label for="id_email">Email:</label>
                    	<div class="input-group">
	                        <input type="email" class="form-control" name="email" id="id_email" placeholder="e-mail" required maxlength="30" value="{{form.email.value}}">
	                        <span class="input-group-addon"><span class="glyphicon glyphicon-asterisk"></span></span>
	                    </div>
	                </div>

	                <div class="form-group">
	                    <label for="id_first_name">First name:</label>
	                    <div class="input-group">
	                        <input type="text" class="form-control" name="first_name" id="id_first_name" placeholder="First name" required maxlength="30"  value="{{form.first_name.value}}">
	                        <span class="input-group-addon"><span class="glyphicon glyphicon-asterisk"></span></span>
	                    </div>
	                </div>


	                <div class="form-group">
	                    <label for="id_last_name">Last name:</label>
	                    <div class="input-group ">
	                        <input type="text" class="form-control" name="last_name" id="id_last_name" placeholder="Last name" required maxlength="30"  value="{{form.last_name.value }}">
	                        <span class="input-group-addon"><span class="glyphicon glyphicon-asterisk"></span></span>
	                    </div>
	                </div>

	                <div class="form-group">
	                    <label for="id_last_name">Links:</label>
	                    <ul class="list-group" id="id_link_list">
			      		{% for link in user_links.all %}
					    	<li class="list-group-item"><i class="fa fa-{{link.link_type.type_tag}} "></i>&nbsp; {{link.link_url}}</li>
					    {% endfor %}
						</ul>
						 
	                </div>
				    <!--{{ form }}-->
				    <input type="submit" value="Submit" class="btn btn-info pull-right" />
				</form>
				<button data-toggle="modal" data-target="#myModal3" class="btn btn-link"> <i class="fa fa-plus"></i>&nbsp;Add new</button>
			</div>
		</div>
    </div>
    <div class="col-md-1">
    </div>
    <div class="col-md-4">

    	<img src="{{STATIC_URL}}img/kolobok.png" alt="ATO.care" class="img-responsive img-rounded">
	</div>
	<div class="col-md-1">
    </div>
</div>
<br />
<br />

<script>
	
    function go_to_url(url) {
        window.location = url;
    }

    $(document).on('click','#BtnSendLink',function(e){
    	var l_url = $("#id_link_url").val()
    	var l_type = $("#id_link_type").val()
		  	$.ajax({
		    	url : "/care/addlink/",
		    	type : "POST",
		    	data : JSON.stringify({"link_url" : l_url, "link_type": l_type,}),
		    	contentType: 'application/json; charset=utf-8',
		    	success : function(results){
		      		if (results.success == "true") {
		      			var insertion = "<li class='list-group-item'>" +
										"<i class='fa fa-" + results.type + 
										"'></i> &nbsp; " +
										results.val + "</li>";
		      			$('#id_link_list').append(insertion);
		      			$('#cat_warning').text('');
		      			$('#cat_warning').hide();
		      			$('#myModal3').modal('hide')
		        	//handle DOM insertion and other stuff
		      		} else {
		      			$('#cat_warning').show();
		      			$('#cat_warning').text(results.message);
		      		}
	    		}
	  		});
	});
</script>
{% endblock %}